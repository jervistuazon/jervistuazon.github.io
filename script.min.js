let currentGalleryImages=[],currentImageIndex=0,currentFolder="",savedScrollPosition=0;function encodePath(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}function isVideo(e){return[".mp4",".webm",".mov",".avi",".mkv"].some(t=>e.toLowerCase().endsWith(t))}document.addEventListener("DOMContentLoaded",()=>{renderGalleryGrid(),history.scrollRestoration&&(history.scrollRestoration="manual"),window.scrollTo(0,0),handleHashRouting();const e=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("is-visible")})},{root:null,rootMargin:"0px",threshold:.15});document.querySelectorAll(".fade-in-scroll").forEach(t=>e.observe(t));const t=document.querySelector(".navbar");window.addEventListener("scroll",()=>{window.scrollY>50?t.classList.add("scrolled"):t.classList.remove("scrolled")}),document.addEventListener("keydown",e=>{const t=document.getElementById("lightbox"),n=document.getElementById("project-view");"Escape"===e.key&&("block"===t.style.display?closeLightbox():"block"===n.style.display&&closeProjectView()),"block"===t.style.display&&("ArrowLeft"===e.key?changeImage(-1):"ArrowRight"===e.key&&changeImage(1))})});const layoutPattern=["span-2-2","span-1-2","","","","span-2-2","",""],layoutPatternMain=["","","","","",""],projectSpanOptions=["span-2-2","span-2-1","span-1-2"],projectSizeOverrides={"Banyan Valley Sabah Terrace Malaysia":"span-1-2"},standaloneSizeOverrides={"Siglap Rd Singapore.png":"span-1-2"};function seededRandom(e){const t=1e4*Math.sin(e);return t-Math.floor(t)}function getRandomProjectSpan(e,t=null){if(t&&projectSizeOverrides[t])return projectSizeOverrides[t];const n=seededRandom(1337*e+42);return projectSpanOptions[Math.floor(n*projectSpanOptions.length)]}function getRandomStandaloneSpan(e,t=null){if(t&&standaloneSizeOverrides[t])return standaloneSizeOverrides[t];if(seededRandom(7919*e+123)<.5)return"";{const t=["span-1-2","span-2-1"],n=seededRandom(3571*e+789);return t[Math.floor(n*t.length)]}}function slugify(e){return e.toLowerCase().replace(/ - F$| -F$/i,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function handleHashRouting(){const e=window.location.hash;if(!e||!e.startsWith("#project/"))return;const t=e.substring(9).split("/");if(t.length<2)return;const n=t[0],o=t[1],a=Object.keys(galleryData);for(const e of a){if(slugify(e)!==n)continue;const t=galleryData[e];if("object"==typeof t&&!Array.isArray(t))for(const n of Object.keys(t))if("_standalone"!==n&&slugify(n)===o)return void setTimeout(()=>{openGallery(e,n)},100)}}function updateUrlHash(e,t){const n=`#project/${slugify(e)}/${slugify(t)}`;window.history.replaceState(null,null,n)}function clearUrlHash(){window.history.replaceState(null,null,window.location.pathname)}function parseProjectName(e){const t=e.replace(/ - F$| -F$/,""),n=t.split(/ - /),o=n[0]||t;let a=null,l=null;for(let e=1;e<n.length;e++){const t=n[e].trim();/^\d{4}$/.test(t)?l=t:t&&(a=t)}return{name:o,location:a,date:l}}function renderGalleryGrid(){const e=document.getElementById("gallery-grid");if(!e||"undefined"==typeof galleryData)return;e.innerHTML="";const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("is-visible")})},{threshold:.1}),n=[],o=[];["Commercial","Hospitality","Institutional","Residential"].forEach(e=>{const t=galleryData[e];if(t&&"object"==typeof t)for(const[a,l]of Object.entries(t)){if(!l||0===l.length)continue;if("_standalone"===a){l.forEach((t,o)=>{n.push({type:"standalone",category:e,categorySlug:e.toLowerCase().replace(/ /g,"-"),filename:t,fileIndex:o,standaloneFiles:l,featured:!1})});continue}const t=/ - F$| -F$/.test(a);let r=l[0];const s=l.find(e=>{const t="object"==typeof e?e.src:e;return t.startsWith("1.")||t.startsWith("1 ")});s&&(r=s),"object"==typeof r&&(r=r.src);const c={type:"project",category:e,categorySlug:e.toLowerCase().replace(/ /g,"-"),projectName:a,thumbSrc:r,files:l,featured:t};t&&o.push(c),n.push(c)}}),galleryData.Video&&Array.isArray(galleryData.Video)&&galleryData.Video.forEach((e,t)=>{n.push({type:"video",category:"Video",categorySlug:"video",filename:e,fileIndex:t,featured:!1})});const a=n.filter(e=>!e.featured),l=a.filter(e=>"video"===e.type),r=a.filter(e=>"project"===e.type),s=a.filter(e=>"standalone"===e.type);[...o,...l,...r,...s].forEach((n,o)=>{const a=document.createElement("div");let l="";if("project"===n.type?(a.setAttribute("data-project","true"),l=n.featured?"span-3-2":getRandomProjectSpan(o,n.projectName)):"video"===n.type?l="span-2-2":"standalone"===n.type&&(l=getRandomStandaloneSpan(o,n.filename)),a.className=`gallery-item fade-in-scroll ${l}`,a.setAttribute("data-category",n.categorySlug),n.featured&&a.setAttribute("data-featured","true"),"project"===n.type){a.onclick=()=>openGallery(n.category,n.projectName),renderMediaItem(a,n.category,n.projectName,n.thumbSrc);renderInfo(a,parseProjectName(n.projectName).name);n.files.length>1&&setupHoverSlideshow(a,n.category,n.projectName,n.files)}else"standalone"===n.type?(a.setAttribute("data-standalone","true"),a.onclick=()=>{currentFolder=n.category,currentGalleryImages=n.standaloneFiles,openLightbox(n.fileIndex)},renderMediaItem(a,n.category,".",n.filename),renderInfo(a,n.filename.replace(/\.[^/.]+$/,"").replace(/^\d+\.\s*/,""))):"video"===n.type&&(a.onclick=()=>{currentFolder="Video",currentGalleryImages=galleryData.Video,openLightbox(n.fileIndex)},renderMediaItem(a,"Video",".",n.filename),renderInfo(a,n.filename.replace(/\.[^/.]+$/,"").replace(/^\d+\.\s*/,"")));e.appendChild(a),t.observe(a)})}function setupHoverSlideshow(e,t,n,o){let a=0,l=null,r=!1;const s=o.slice(0,3).map(e=>"object"==typeof e?e.src:e);s.length<=1||(e.addEventListener("mouseenter",()=>{a=0,r=!1;const o=e.querySelector(".gallery-img"),c=e.querySelector(".gallery-img-alt");if(o&&c&&s.length>1){a=1;const e=s[1],l=`assets/${t}/${n}/${e}`;c.src=encodePath(l),c.style.opacity="1",o.style.opacity="0"}l=setInterval(()=>{a=(a+1)%s.length;const o=s[a],l=e.querySelector(".gallery-img"),c=e.querySelector(".gallery-img-alt");if(l&&c){const e=`assets/${t}/${n}/${o}`;r?(c.src=encodePath(e),c.style.opacity="1",l.style.opacity="0"):(l.src=encodePath(e),l.style.opacity="1",c.style.opacity="0"),r=!r}},2200)}),e.addEventListener("mouseleave",()=>{l&&(clearInterval(l),l=null);const o=e.querySelector(".gallery-img"),a=e.querySelector(".gallery-img-alt");if(o&&a){const e=s[0],l=`assets/${t}/${n}/${e}`;o.src=encodePath(l),o.style.opacity="1",a.style.opacity="0"}}))}function renderMediaItem(e,t,n,o){let a;a="."!==n&&n?`assets/${t}/${n}/${o}`:`assets/${t}/${o}`;const l=encodePath(a);if(e.classList.add("loading"),isVideo(o)){const t=document.createElement("video");t.src=l,t.muted=!0,t.loop=!0,t.playsInline=!0,t.autoplay=!0,t.className="gallery-video",t.addEventListener("loadeddata",()=>{e.classList.remove("loading"),e.classList.add("loaded")}),t.addEventListener("error",()=>{e.classList.remove("loading")}),e.appendChild(t)}else{const t=document.createElement("img");t.src=l,t.alt=o,t.className="gallery-img",t.loading="lazy",t.style.opacity="1";const n=document.createElement("img");n.src=l,n.alt=o,n.className="gallery-img-alt",n.loading="lazy",n.style.opacity="0",t.addEventListener("load",()=>{e.classList.remove("loading"),e.classList.add("loaded")}),t.addEventListener("error",()=>{e.classList.remove("loading")}),e.appendChild(n),e.appendChild(t)}}function renderInfo(e,t){const n=document.createElement("div");n.className="item-info";const o=document.createElement("h4");o.textContent=t,n.appendChild(o),e.appendChild(n)}function openGallery(e,t){let n,o,a;if(e&&t){if(!galleryData[e]||!galleryData[e][t])return;n=galleryData[e][t],o=t.replace(/ - F$| -F$/,""),a=`assets/${e}/${t}`,currentFolder=`${e}/${t}`}else{if(!galleryData[e])return;n=galleryData[e],o=e,a=`assets/${e}`,currentFolder=e}currentGalleryImages=n.map(e=>"object"==typeof e?e.src:e);const l=document.getElementById("project-grid"),r=document.getElementById("project-title"),s=document.getElementById("project-view"),c=parseProjectName(t);r.innerHTML=`\n        <span class="project-name">${c.name}</span>\n        ${c.location||c.date?`<span class="project-meta">${[c.location,c.date].filter(Boolean).join(" â€¢ ")}</span>`:""}\n    `,l.innerHTML="";let i=0;const d=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("is-visible")})},{threshold:.1});n.forEach((e,t)=>{const n="object"==typeof e,o=n?e.src:e,r=n?e.span:null,s=document.createElement("div"),c=r||layoutPatternMain[i%layoutPatternMain.length];s.className=`gallery-item fade-in-scroll ${c}`,s.onclick=()=>openLightbox(t),i++;const u=encodePath(`${a}/${o}`);if(s.classList.add("loading"),isVideo(o)){const e=document.createElement("video");e.src=u,e.muted=!0,e.loop=!0,e.playsInline=!0,e.autoplay=!0,e.className="gallery-video",e.addEventListener("loadeddata",()=>{s.classList.remove("loading"),s.classList.add("loaded")}),e.addEventListener("error",()=>{s.classList.remove("loading")}),s.appendChild(e)}else{const e=document.createElement("img");e.src=u,e.alt=o,e.className="gallery-img",e.addEventListener("load",()=>{s.classList.remove("loading"),s.classList.add("loaded")}),e.addEventListener("error",()=>{s.classList.remove("loading")}),s.appendChild(e)}const m=document.createElement("div");m.className="item-info";const p=document.createElement("h4");p.textContent=o.replace(/\.[^/.]+$/,"").replace(/^\d+\.\s*/,""),m.appendChild(p),s.appendChild(m),l.appendChild(s),d.observe(s)}),savedScrollPosition=window.scrollY||document.documentElement.scrollTop,e&&t&&updateUrlHash(e,t),s.style.display="block",setTimeout(()=>s.classList.add("active"),10),document.body.style.overflow="hidden"}function closeProjectView(){const e=document.getElementById("project-view");e.classList.remove("active"),clearUrlHash(),setTimeout(()=>{e.style.display="none",document.body.style.overflow="auto",window.scrollTo(0,savedScrollPosition)},300)}function toggleDropdown(){document.getElementById("mobile-filter-options").classList.toggle("active")}function selectFilter(e){const t=document.getElementById("mobile-filter-options"),n=document.querySelector(`.option-item[onclick="selectFilter('${e}')"]`).textContent;document.querySelector(".selected-option").textContent=n.toUpperCase(),document.querySelectorAll(".option-item").forEach(e=>e.classList.remove("selected")),document.querySelector(`.option-item[onclick="selectFilter('${e}')"]`).classList.add("selected"),t.classList.remove("active"),filterGallery(e,null)}function openLightbox(e){currentImageIndex=e,updateLightboxContent();const t=document.getElementById("lightbox");t.style.display="block",setTimeout(()=>t.classList.add("active"),10)}function updateLightboxContent(){const e=document.getElementById("lightbox-content-container"),t=document.getElementById("caption"),n=currentGalleryImages[currentImageIndex];if(!n)return;const o=encodePath(`assets/${currentFolder}/${n}`);let a;e.innerHTML="",isVideo(n)?(a=document.createElement("video"),a.src=o,a.controls=!0,a.autoplay=!0,a.playsInline=!0,a.className="lightbox-content",a.style.opacity="1",a.style.display="block"):(a=document.createElement("img"),a.src=o,a.alt=n,a.className="lightbox-content",a.style.opacity="1",a.style.display="block",a.style.animation="none"),e.appendChild(a),t.textContent=n.replace(/\.[^/.]+$/,"").replace(/^\d+\.\s*/,"")}function changeImage(e){currentImageIndex+=e,currentImageIndex<0?currentImageIndex=currentGalleryImages.length-1:currentImageIndex>=currentGalleryImages.length&&(currentImageIndex=0),updateLightboxContent()}function closeLightbox(){const e=document.getElementById("lightbox"),t=document.getElementById("lightbox-content-container");e.classList.remove("active"),setTimeout(()=>{e.style.display="none",t.innerHTML=""},300)}function encodePath(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}function isVideo(e){return/\.(mp4|webm|mov)$/i.test(e)}window.addEventListener("click",function(e){const t=document.querySelector(".custom-dropdown"),n=document.getElementById("mobile-filter-options");t&&!t.contains(e.target)&&n.classList.contains("active")&&n.classList.remove("active")}),document.addEventListener("keydown",e=>{document.getElementById("lightbox").classList.contains("active")&&("Escape"===e.key?closeLightbox():"ArrowLeft"===e.key?changeImage(-1):"ArrowRight"===e.key&&changeImage(1))});const lenis=new Lenis({duration:1.2,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),direction:"vertical",gestureDirection:"vertical",smooth:!0,mouseMultiplier:1,smoothTouch:!1,touchMultiplier:2});function raf(e){lenis.raf(e),requestAnimationFrame(raf)}function filterGallery(e,t){const n=document.querySelectorAll(".filter-btn");n.forEach(e=>e.classList.remove("active")),t&&t.target?t.target.classList.add("active"):n.forEach(t=>{(t.textContent.toLowerCase().includes(e.toLowerCase())||"all"===e&&"All"===t.textContent)&&t.classList.add("active")});document.querySelectorAll(".gallery-item").forEach(t=>{const n=t.getAttribute("data-category"),o="true"===t.getAttribute("data-featured");let a=!1;a="all"===e||("featured"===e?o:n===e),a?(t.style.display="block",t.style.opacity="1",t.style.transform="translateY(0)"):t.style.display="none"});document.getElementById("gallery-grid").style.gridTemplateColumns="",reassignLayoutPattern()}function reassignLayoutPattern(){Array.from(document.querySelectorAll(".gallery-item")).filter(e=>"none"!==e.style.display).forEach((e,t)=>{e.classList.remove("span-3-2","span-2-2","span-2-1","span-1-2");const n="true"===e.getAttribute("data-featured"),o="true"===e.getAttribute("data-project");if(n)e.classList.add("span-3-2");else if(o){const n=getRandomProjectSpan(t);n&&e.classList.add(n)}})}requestAnimationFrame(raf);