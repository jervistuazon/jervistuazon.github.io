let currentGalleryImages=[],currentImageIndex=0,currentFolder="",savedScrollPosition=0;const ITEMS_PER_PAGE=24;let visibleLimit=24,currentFilter="all";function encodePath(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}function isVideo(e){return[".mp4",".webm",".mov",".avi",".mkv"].some(t=>e.toLowerCase().endsWith(t))}document.addEventListener("DOMContentLoaded",()=>{renderGalleryGrid(),history.scrollRestoration&&(history.scrollRestoration="manual"),window.scrollTo(0,0),handleHashRouting();const e=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("is-visible")})},{root:null,rootMargin:"0px",threshold:.15});document.querySelectorAll(".fade-in-scroll").forEach(t=>e.observe(t));const t=document.querySelector(".navbar");window.addEventListener("scroll",()=>{window.scrollY>50?t.classList.add("scrolled"):t.classList.remove("scrolled")}),document.addEventListener("keydown",e=>{const t=document.getElementById("lightbox"),n=document.getElementById("project-view");"Escape"===e.key&&("block"===t.style.display?closeLightbox():"block"===n.style.display&&closeProjectView()),"block"===t.style.display&&("ArrowLeft"===e.key?changeImage(-1):"ArrowRight"===e.key&&changeImage(1))})});const layoutPattern=["span-2-2","span-1-2","","","","span-2-2","",""],layoutPatternMain=["","","","","",""],projectSpanOptions=["span-2-2","span-2-1","span-1-2"],projectSizeOverrides={"Banyan Valley Sabah Terrace Malaysia":"span-1-2"},standaloneSizeOverrides={"Siglap Rd Singapore.png":"span-1-2"};function seededRandom(e){const t=1e4*Math.sin(e);return t-Math.floor(t)}function seededShuffle(e,t){let n,a,o=e.length;for(;o;)a=Math.floor(seededRandom(t+o)*o--),n=e[o],e[o]=e[a],e[a]=n;return e}function getRandomProjectSpan(e,t=null){if(t&&projectSizeOverrides[t])return projectSizeOverrides[t];const n=seededRandom(1337*e+42);return projectSpanOptions[Math.floor(n*projectSpanOptions.length)]}function getRandomStandaloneSpan(e,t=null){if(t&&standaloneSizeOverrides[t])return standaloneSizeOverrides[t];const n=seededRandom(7919*e+123);return n<.4?"":n<.7?"span-1-2":"span-2-1"}const mobileAspectRatios=["mobile-ar-4-5","mobile-ar-5-4","mobile-ar-2-3","mobile-ar-5-7"];function getMobileAspectRatioClass(e){const t=seededRandom(2803*e+77);return mobileAspectRatios[Math.floor(t*mobileAspectRatios.length)]}function slugify(e){return e.toLowerCase().replace(/ - F$| -F$/i,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function handleHashRouting(){const e=window.location.hash;if(!e||!e.startsWith("#project/"))return;const t=e.substring(9).split("/");if(t.length<2)return;const n=t[0],a=t[1],o=Object.keys(galleryData);for(const e of o){if(slugify(e)!==n)continue;const t=galleryData[e];if("object"==typeof t&&!Array.isArray(t))for(const n of Object.keys(t))if("_standalone"!==n&&slugify(n)===a)return void setTimeout(()=>{openGallery(e,n)},100)}}function updateUrlHash(e,t){const n=`#project/${slugify(e)}/${slugify(t)}`;window.history.replaceState(null,null,n)}function clearUrlHash(){window.history.replaceState(null,null,window.location.pathname)}function parseProjectName(e){const t=e.replace(/\s-\s*F\s*$/,""),n=t.split(/ - /),a=n[0]||t;let o=null,l=null;for(let e=1;e<n.length;e++){const t=n[e].trim();/^\d{4}$/.test(t)?l=t:t&&(o=t)}return{name:a,location:o,date:l}}function renderGalleryGrid(){const e=document.getElementById("gallery-grid");if(!e||"undefined"==typeof galleryData)return;e.innerHTML="";const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("is-visible")})},{threshold:.1}),n=[],a=[];["Commercial","Hospitality","Institutional","Residential"].forEach(e=>{const t=galleryData[e];if(t&&"object"==typeof t)for(const[o,l]of Object.entries(t)){if(!l||0===l.length)continue;if("_standalone"===o){l.forEach((t,a)=>{n.push({type:"standalone",category:e,categorySlug:e.toLowerCase().replace(/ /g,"-"),filename:t,fileIndex:a,standaloneFiles:l,featured:!1})});continue}const t=/\s-\s*F\s*$/.test(o);let s=l[0];const r=l.find(e=>{const t="object"==typeof e?e.src:e;return t.startsWith("1.")||t.startsWith("1 ")});r&&(s=r),"object"==typeof s&&(s=s.src);const i={type:"project",category:e,categorySlug:e.toLowerCase().replace(/ /g,"-"),projectName:o,thumbSrc:s,files:l,featured:t};t&&a.push(i),n.push(i)}}),galleryData.Video&&Array.isArray(galleryData.Video)&&galleryData.Video.forEach((e,t)=>{n.push({type:"video",category:"Video",categorySlug:"video",filename:e,fileIndex:t,featured:!1})});const o=n.filter(e=>!e.featured),l=o.filter(e=>"video"===e.type),s=o.filter(e=>"project"===e.type);let r=o.filter(e=>"standalone"===e.type);const i=r.findIndex(e=>"Rangoon Road Singapore.webp"===e.filename);if(-1!==i){const e=r.splice(i,1)[0];s.push(e)}r=seededShuffle(r,999);[...a,...l,...s,...r].forEach((n,a)=>{const o=document.createElement("div");let l="";"project"===n.type?(o.setAttribute("data-project","true"),o.setAttribute("data-project-name",n.projectName),l=n.featured?"span-3-2":getRandomProjectSpan(a,n.projectName)):"video"===n.type?(l="span-2-2",o.setAttribute("data-type","video")):"standalone"===n.type&&(o.setAttribute("data-standalone","true"),o.setAttribute("data-filename",n.filename),l=getRandomStandaloneSpan(a,n.filename));const s=n.featured?"":getMobileAspectRatioClass(a);if(o.className=`gallery-item fade-in-scroll ${l} ${s}`.trim(),o.setAttribute("data-category",n.categorySlug),n.featured&&o.setAttribute("data-featured","true"),"project"===n.type){o.onclick=()=>openGallery(n.category,n.projectName),renderMediaItem(o,n.category,n.projectName,n.thumbSrc);renderInfo(o,parseProjectName(n.projectName).name);n.files.length>1&&setupHoverSlideshow(o,n.category,n.projectName,n.files)}else"standalone"===n.type?(o.setAttribute("data-standalone","true"),o.onclick=()=>{currentFolder=n.category,currentGalleryImages=n.standaloneFiles,openLightbox(n.fileIndex)},renderMediaItem(o,n.category,".",n.filename),renderInfo(o,n.filename.replace(/\.[^/.]+$/,"").replace(/^\d+\.\s*/,""))):"video"===n.type&&(o.onclick=()=>{currentFolder="Video",currentGalleryImages=galleryData.Video,openLightbox(n.fileIndex)},renderMediaItem(o,"Video",".",n.filename),renderInfo(o,n.filename.replace(/\.[^/.]+$/,"").replace(/^\d+\.\s*/,"")));e.appendChild(o),t.observe(o)}),filterGallery("all")}function setupHoverSlideshow(e,t,n,a){let o=0,l=null,s=!1;const r=a.slice(0,3).map(e=>"object"==typeof e?e.src:e);if(r.length<=1)return;const i=()=>{if(l)return;o=0,s=!1;const a=e.querySelector(".gallery-img"),i=e.querySelector(".gallery-img-alt");if(a&&i&&r.length>1){o=1;const e=r[1],l=`assets/${t}/${n}/${e}`;i.src=encodePath(l),i.style.opacity="1",a.style.opacity="0"}l=setInterval(()=>{o=(o+1)%r.length;const a=r[o],l=e.querySelector(".gallery-img"),i=e.querySelector(".gallery-img-alt");if(l&&i){const e=`assets/${t}/${n}/${a}`;s?(i.src=encodePath(e),i.style.opacity="1",l.style.opacity="0"):(l.src=encodePath(e),l.style.opacity="1",i.style.opacity="0"),s=!s}},2200)},c=()=>{l&&(clearInterval(l),l=null);const a=e.querySelector(".gallery-img"),o=e.querySelector(".gallery-img-alt");if(a&&o){const e=r[0],l=`assets/${t}/${n}/${e}`;a.src=encodePath(l),a.style.opacity="1",o.style.opacity="0"}};e.addEventListener("mouseenter",i),e.addEventListener("mouseleave",c),e.addEventListener("touchstart",i,{passive:!0}),e.addEventListener("touchend",c),e.addEventListener("touchcancel",c)}function renderMediaItem(e,t,n,a){let o;o="."!==n&&n?`assets/${t}/${n}/${a}`:`assets/${t}/${a}`;const l=encodePath(o);if(e.classList.add("loading"),isVideo(a)){const t=document.createElement("video");t.src=l,t.muted=!0,t.loop=!0,t.playsInline=!0,t.autoplay=!0,t.className="gallery-video",t.addEventListener("loadeddata",()=>{e.classList.remove("loading"),e.classList.add("loaded")}),t.addEventListener("error",()=>{e.classList.remove("loading")}),e.appendChild(t)}else{const t=document.createElement("img");t.src=l,t.alt=a,t.className="gallery-img",t.loading="lazy",t.style.opacity="1";const n=document.createElement("img");n.src=l,n.alt=a,n.className="gallery-img-alt",n.loading="lazy",n.style.opacity="0",t.addEventListener("load",()=>{e.classList.remove("loading"),e.classList.add("loaded")}),t.addEventListener("error",()=>{e.classList.remove("loading")}),e.appendChild(n),e.appendChild(t)}}function renderInfo(e,t){const n=document.createElement("div");n.className="item-info";const a=document.createElement("h4");a.textContent=t,n.appendChild(a),e.appendChild(n)}function openGallery(e,t){let n,a,o;if(e&&t){if(!galleryData[e]||!galleryData[e][t])return;n=galleryData[e][t],a=t.replace(/ - F$| -F$/,""),o=`assets/${e}/${t}`,currentFolder=`${e}/${t}`}else{if(!galleryData[e])return;n=galleryData[e],a=e,o=`assets/${e}`,currentFolder=e}currentGalleryImages=n.map(e=>"object"==typeof e?e.src:e);const l=document.getElementById("project-grid"),s=document.getElementById("project-title"),r=document.getElementById("project-view"),i=parseProjectName(t);s.innerHTML=`\n        <span class="project-name">${i.name}</span>\n        ${i.location||i.date?`<span class="project-meta">${[i.location,i.date].filter(Boolean).join(" â€¢ ")}</span>`:""}\n    `,l.innerHTML="";let c=0;const d=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("is-visible")})},{threshold:.1});n.forEach((e,t)=>{const n="object"==typeof e,a=n?e.src:e,s=n?e.span:null,r=document.createElement("div"),i=s||layoutPatternMain[c%layoutPatternMain.length];r.className=`gallery-item fade-in-scroll ${i}`,r.onclick=()=>openLightbox(t),c++;const m=encodePath(`${o}/${a}`);if(r.classList.add("loading"),isVideo(a)){const e=document.createElement("video");e.src=m,e.muted=!0,e.loop=!0,e.playsInline=!0,e.autoplay=!0,e.className="gallery-video",e.addEventListener("loadeddata",()=>{r.classList.remove("loading"),r.classList.add("loaded")}),e.addEventListener("error",()=>{r.classList.remove("loading")}),r.appendChild(e)}else{const e=document.createElement("img");e.src=m,e.alt=a,e.className="gallery-img",e.addEventListener("load",()=>{r.classList.remove("loading"),r.classList.add("loaded")}),e.addEventListener("error",()=>{r.classList.remove("loading")}),r.appendChild(e)}const u=document.createElement("div");u.className="item-info";const p=document.createElement("h4");p.textContent=a.replace(/\.[^/.]+$/,"").replace(/^\d+\.\s*/,""),u.appendChild(p),r.appendChild(u),l.appendChild(r),d.observe(r)}),savedScrollPosition=window.scrollY||document.documentElement.scrollTop,e&&t&&updateUrlHash(e,t),r.style.display="block",setTimeout(()=>{r.classList.add("active"),projectLenis||(projectLenis=new Lenis({wrapper:r,content:r,duration:1.2,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),direction:"vertical",gestureDirection:"vertical",smooth:!0,mouseMultiplier:1,smoothTouch:!1,touchMultiplier:2,infinite:!1}))},10),document.body.style.overflow="hidden"}function closeProjectView(){const e=document.getElementById("project-view");e.classList.remove("active"),projectLenis&&(projectLenis.destroy(),projectLenis=null),clearUrlHash(),setTimeout(()=>{e.style.display="none",document.body.style.overflow="auto",window.scrollTo(0,savedScrollPosition)},300)}function toggleDropdown(){document.getElementById("mobile-filter-options").classList.toggle("active")}function selectFilter(e){const t=document.getElementById("mobile-filter-options"),n=document.querySelector(`.option-item[onclick="selectFilter('${e}')"]`).textContent;document.querySelector(".selected-option").textContent=n.toUpperCase(),document.querySelectorAll(".option-item").forEach(e=>e.classList.remove("selected")),document.querySelector(`.option-item[onclick="selectFilter('${e}')"]`).classList.add("selected"),t.classList.remove("active"),filterGallery(e,null)}function openLightbox(e){currentImageIndex=e,updateLightboxContent();const t=document.getElementById("lightbox");t.style.display="block",setTimeout(()=>t.classList.add("active"),10)}function updateLightboxContent(){const e=document.getElementById("lightbox-content-container"),t=document.getElementById("caption"),n=currentGalleryImages[currentImageIndex];if(!n)return;const a=encodePath(`assets/${currentFolder}/${n}`);let o;e.innerHTML="",isVideo(n)?(o=document.createElement("video"),o.src=a,o.controls=!0,o.autoplay=!0,o.playsInline=!0,o.className="lightbox-content",o.style.opacity="1",o.style.display="block"):(o=document.createElement("img"),o.src=a,o.alt=n,o.className="lightbox-content",o.style.opacity="1",o.style.display="block",o.style.animation="none"),e.appendChild(o),t.textContent=n.replace(/\.[^/.]+$/,"").replace(/^\d+\.\s*/,"")}function changeImage(e){currentImageIndex+=e,currentImageIndex<0?currentImageIndex=currentGalleryImages.length-1:currentImageIndex>=currentGalleryImages.length&&(currentImageIndex=0),updateLightboxContent()}function closeLightbox(){const e=document.getElementById("lightbox"),t=document.getElementById("lightbox-content-container");e.classList.remove("active"),setTimeout(()=>{e.style.display="none",t.innerHTML=""},300)}function encodePath(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}function isVideo(e){return/\.(mp4|webm|mov)$/i.test(e)}window.addEventListener("click",function(e){const t=document.querySelector(".custom-dropdown"),n=document.getElementById("mobile-filter-options");t&&!t.contains(e.target)&&n.classList.contains("active")&&n.classList.remove("active")}),document.addEventListener("keydown",e=>{document.getElementById("lightbox").classList.contains("active")&&("Escape"===e.key?closeLightbox():"ArrowLeft"===e.key?changeImage(-1):"ArrowRight"===e.key&&changeImage(1))});const lenis=new Lenis({duration:1.2,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),direction:"vertical",gestureDirection:"vertical",smooth:!0,mouseMultiplier:1,smoothTouch:!1,touchMultiplier:2});let projectLenis=null;function raf(e){lenis.raf(e),projectLenis&&projectLenis.raf(e),requestAnimationFrame(raf)}function filterGallery(e,t,n=!1){n||(currentFilter=e,visibleLimit=24);const a=document.querySelectorAll(".filter-btn");a.forEach(e=>e.classList.remove("active")),t&&t.target?t.target.classList.add("active"):a.forEach(t=>{(t.textContent.toLowerCase().includes(e.toLowerCase())||"all"===e&&"All"===t.textContent)&&t.classList.add("active")});const o=Array.from(document.querySelectorAll(".gallery-item")),l=o.filter(t=>{const n=t.getAttribute("data-category"),a="true"===t.getAttribute("data-featured");return"all"===e||("featured"===e?a:n===e)}),s=l.slice(0,visibleLimit);let r=0;o.forEach(e=>{const t=s.includes(e),n="none"!==e.style.display&&!e.classList.contains("hidden-item");t?(e.classList.remove("hidden-item"),e.style.display="block",n?e.style.transitionDelay="0s":(e.style.transitionDelay=50*r+"ms",r++),requestAnimationFrame(()=>{e.style.opacity="1",e.style.transform="translateY(0) scale(1)"})):(e.classList.add("hidden-item"),e.style.display="none",e.style.opacity="0",e.style.transform="translateY(50px) scale(0.95)",e.style.transitionDelay="0s")});const i=document.getElementById("load-more-btn"),c=document.getElementById("load-more-container");i&&c&&(l.length>visibleLimit?(i.classList.remove("hidden"),c.style.display="flex"):(i.classList.add("hidden"),c.style.display="none"));document.getElementById("gallery-grid").style.gridTemplateColumns="",reassignLayoutPattern()}function loadMoreItems(){visibleLimit+=24,filterGallery(currentFilter,null,!0)}function reassignLayoutPattern(){Array.from(document.querySelectorAll(".gallery-item")).filter(e=>"none"!==e.style.display).forEach((e,t)=>{e.classList.remove("span-3-2","span-2-2","span-2-1","span-1-2");const n="true"===e.getAttribute("data-featured"),a="true"===e.getAttribute("data-project"),o=e.getAttribute("data-project-name");if(n)e.classList.add("span-3-2");else if(a)if(o&&projectSizeOverrides[o])e.classList.add(projectSizeOverrides[o]);else{const n=getRandomProjectSpan(t);n&&e.classList.add(n)}else if("true"===e.getAttribute("data-standalone")){const n=seededRandom(773*t+42);n<.2?e.classList.add("span-1-2"):n<.4&&e.classList.add("span-2-1")}else"video"===e.getAttribute("data-type")&&e.classList.add("span-2-2")})}requestAnimationFrame(raf),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("contact-container");if(e){const t=`${"jervistuazon"}@${"gmail.com"}`,n="+65",a="9447",o="4504",l=`${n} ${a} ${o}`,s=`${n}${a}${o}`,r=document.createElement("p");r.className="contact-link";const i=document.createElement("a");i.href=`mailto:${t}`,i.textContent=t,r.appendChild(i);const c=document.createElement("p");c.className="contact-link";const d=document.createElement("a");d.href=`tel:${s}`,d.textContent=l,c.appendChild(d),e.appendChild(r),e.appendChild(c)}});